<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin • Tournament Players</title>

<style>
:root{
  --bg:#0b0b0b;
  --card:#121212;
  --border:#242424;
  --accent:#00faff;
  --success:#22c55e;
  --danger:#ef4444;
  --muted:#9aa4af;
}

*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

body{
  margin:0;
  background:var(--bg);
  color:#fff;
  padding:0;
}

/* ---------- ANDROID APP BAR ---------- */
.app-bar{
  position:sticky;
  top:0;
  z-index:1000;
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 14px;
  background:rgba(10,10,10,0.95);
  backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
}

.back-btn{
  width:40px;
  height:40px;
  border-radius:50%;
  background:#111;
  color:#fff;
  font-size:22px;
  border:1px solid #222;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.back-btn:active{
  background:#1f2937;
}

.app-title{
  font-size:16px;
  font-weight:600;
  color:var(--accent);
}

/* ---------- PAGE CONTENT ---------- */
.page{
  padding:14px;
}

.select-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

select,button{
  flex:1;
  min-width:120px;
  background:#0f172a;
  color:#fff;
  border:1px solid #1f2937;
  padding:10px;
  border-radius:10px;
  font-size:14px;
}

button{
  background:linear-gradient(135deg,#00faff,#38bdf8);
  border:none;
  color:#000;
  font-weight:600;
}

.info{
  margin-top:12px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  font-size:13px;
  color:var(--muted);
}

.table-wrap{
  margin-top:14px;
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:720px;
}

th,td{
  padding:10px;
  text-align:center;
  font-size:13px;
  border-bottom:1px solid var(--border);
}

th{
  background:#0f172a;
  color:var(--accent);
  position:sticky;
  top:0;
}

.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  border:2px solid var(--accent);
  object-fit:cover;
}

.paid-yes{color:var(--success);font-weight:600}
.paid-no{color:var(--danger);font-weight:600}

.empty{
  text-align:center;
  color:var(--muted);
  padding:20px;
}

/* ---------- SWIPE BACK ---------- */
.swipe-area{
  position:fixed;
  left:0;
  top:0;
  width:26px;
  height:100%;
  z-index:9998;
}

.swipe-arrow{
  position:fixed;
  left:-42px;
  top:50%;
  transform:translateY(-50%);
  width:38px;
  height:38px;
  background:rgba(0,0,0,0.75);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#fff;
  box-shadow:0 0 14px rgba(0,250,255,.6);
  opacity:0;
  transition:.15s ease;
  z-index:9999;
}
</style>
</head>

<body>

<!-- ANDROID BACK BAR -->
<div class="app-bar">
  <button class="back-btn" onclick="goBack()">←</button>
  <span class="app-title">Admin • Tournament Players</span>
</div>

<!-- SWIPE ELEMENTS -->
<div class="swipe-area"></div>
<div class="swipe-arrow">←</div>

<div class="select-card">
  <select id="tournamentSelect">
    <option>Loading tournaments…</option>
  </select>
  <button onclick="loadTournamentPlayers()">Load</button>
</div>

<div class="info">
  <div id="tournamentName">Tournament Info</div>
  <div id="tournamentInfo"></div>
  <div id="message" style="color:#ef4444"></div>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
  <th>Avatar</th>
  <th>Name</th>
  <th>Phone</th>
  <th>Wallet</th>
  <th>Game UID</th>
  <th>Paid</th>
  <th>Joined</th>
</tr>
</thead>
<tbody id="playersBody">
<tr><td colspan="7" class="empty">Select a tournament</td></tr>
</tbody>
</table>
</div>

<script>
const API='https://battlepurse-88.onrender.com/api/wallet';
const token=localStorage.getItem('token');
const select=document.getElementById('tournamentSelect');
const body=document.getElementById('playersBody');

function fmt(d){
  return d?new Date(d).toLocaleString():'—';
}

async function loadTournamentsList(){
  const r=await fetch(`${API}/tournaments`,{headers:{Authorization:`Bearer ${token}`}});
  const t=await r.json();
  select.innerHTML='<option value="">Select Tournament</option>';
  t.forEach(x=>{
    select.innerHTML+=`<option value="${x._id}">${x.name} | ${x.game}</option>`;
  });
}

async function loadTournamentPlayers(){
  if(!select.value)return;
  const r=await fetch(`${API}/tournaments/${select.value}/players`,
    {headers:{Authorization:`Bearer ${token}`}});
  const d=await r.json();

  document.getElementById('tournamentName').innerText=d.tournamentName;
  document.getElementById('tournamentInfo').innerText=
    `${d.game} • ${d.mode} • ₹${d.entryFee} • Players ${d.totalPlayers}/${d.maxPlayers}`;

  body.innerHTML='';
  if(!d.players.length){
    body.innerHTML=`<tr><td colspan="7" class="empty">No players yet</td></tr>`;
    return;
  }

  d.players.forEach(p=>{
    body.innerHTML+=`
    <tr>
      <td><img class="avatar" src="${p.avatarUrl||'https://via.placeholder.com/40'}"></td>
      <td>${p.name}</td>
      <td>${p.phone}</td>
      <td>₹${p.wallet}</td>
      <td>${p.gameUIDs.join(', ')||'—'}</td>
      <td class="${p.paid?'paid-yes':'paid-no'}">${p.paid?'Yes':'No'}</td>
      <td>${fmt(p.joinedAt)}</td>
    </tr>`;
  });
}

loadTournamentsList();

/* ---------- ANDROID SWIPE BACK ---------- */
let sx=0,sy=0;
const arrow=document.querySelector('.swipe-arrow');

function goBack(){
  history.length>1?history.back():location.href='gamezone.html';
}

addEventListener('touchstart',e=>{
  if(e.touches[0].clientX<28){
    sx=e.touches[0].clientX;
    sy=e.touches[0].clientY;
    arrow.style.opacity=1;
  }
});

addEventListener('touchmove',e=>{
  if(!sx)return;
  let dx=e.touches[0].clientX-sx;
  if(dx>0)arrow.style.left=Math.min(dx-18,44)+'px';
});

addEventListener('touchend',e=>{
  let dx=e.changedTouches[0].clientX-sx;
  let dy=Math.abs(e.changedTouches[0].clientY-sy);
  arrow.style.left='-42px';
  arrow.style.opacity=0;
  if(sx<28&&dx>90&&dy<60)goBack();
  sx=0;
});
</script>

</body>
</html>
