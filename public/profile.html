<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Profile</title>

<style>
:root {
  --primary: #00faff;
  --bg: #121212;
  --card: #1c1c1c;
}

* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
  -webkit-tap-highlight-color: transparent;
}

body {
  margin: 0;
  background: var(--bg);
  color: #fff;
  padding-bottom: 70px;
}

/* ğŸ” APP BAR */
.app-bar {
  position: sticky;
  top: 0;
  z-index: 100;
  height: 56px;
  background: #1a1a1a;
  display: flex;
  align-items: center;
  padding: 0 14px;
  box-shadow: 0 3px 8px #00000080;
}

.app-bar button {
  background: none;
  border: none;
  color: var(--primary);
  font-size: 22px;
  margin-right: 12px;
  cursor: pointer;
}

.app-title {
  font-size: 17px;
  font-weight: 600;
  color: var(--primary);
}

/* ğŸ“¦ CONTENT */
.container {
  max-width: 480px;
  margin: 14px auto;
  padding: 18px;
  background: var(--card);
  border-radius: 18px;
  box-shadow: 0 0 14px #00faff33;
}

/* ğŸ‘¤ AVATAR */
.avatar {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  margin: 10px auto;
  display: block;
  border: 3px solid var(--primary);
  object-fit: cover;
}

.upload-btn {
  text-align: center;
  margin-bottom: 14px;
}

.upload-btn input {
  font-size: 12px;
}

/* â„¹ USER INFO */
.user-info {
  text-align: center;
  margin-bottom: 14px;
}

.user-info div {
  font-size: 14px;
  margin: 5px 0;
}

/* âœ INPUTS */
label {
  display: block;
  margin-top: 14px;
  font-size: 13px;
  font-weight: 600;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border-radius: 12px;
  border: none;
  background: #111;
  color: #fff;
  box-shadow: inset 0 0 5px #00faff44;
}

/* ğŸ’° WALLET */
.wallet {
  margin: 18px 0;
  padding: 16px;
  text-align: center;
  font-size: 18px;
  background: #191919;
  border-radius: 14px;
  box-shadow: 0 0 12px #00faff66;
}

/* ğŸ”˜ BUTTONS */
.button {
  width: 100%;
  padding: 14px;
  border-radius: 30px;
  border: none;
  margin-bottom: 12px;
  font-size: 16px;
  font-weight: 700;
  background: var(--primary);
  color: #000;
  cursor: pointer;
}

.button.secondary {
  background: #333;
  color: #fff;
}

/* ğŸ‘® ADMIN */
#adminSection {
  display: none;
  margin-top: 18px;
  text-align: center;
}

/* â¬‡ BOTTOM NAV */
footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: #1e1e1e;
  display: flex;
  justify-content: space-around;
  align-items: center;
  border-top: 1px solid #333;
}

.nav-btn {
  text-align: center;
  font-size: 12px;
  color: #aaa;
  cursor: pointer;
}

.nav-btn.active {
  color: var(--primary);
}

/* ğŸ§­ Swipe Back Edge */
.swipe-area {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  width: 24px;
  z-index: 50;
}
</style>
</head>

<body>

<!-- Swipe-back edge -->
<div class="swipe-area"></div>

<!-- ğŸ” App Bar -->
<div class="app-bar">
  <button onclick="goBack()">â†</button>
  <div class="app-title">Profile</div>
</div>

<div class="container">

  <img id="avatar-img"
       src="https://img.icons8.com/color/96/user.png"
       class="avatar">

  <div class="upload-btn">
    <input type="file" id="avatarInput" accept="image/*" onchange="uploadAvatar()">
  </div>

  <div class="user-info">
    <div><strong>Name:</strong> <span id="username">Loading...</span></div>
    <div><strong>Mobile:</strong> <span id="mobile">Loading...</span></div>
    <div><strong>Email:</strong> <span id="email">Loading...</span></div>
    <div><strong>User ID:</strong> <span id="userid">Loading...</span></div>
  </div>

  <label>Free Fire UID</label>
  <input type="text" id="ffid" disabled>

  <label>BGMI UID</label>
  <input type="text" id="bgmiid" disabled>

  <label>Carrom Pool UID</label>
  <input type="text" id="carrom" disabled>

  <label>Ludo King UID</label>
  <input type="text" id="ludo" disabled>

  <div class="wallet">
    Wallet Balance: â‚¹<span id="wallet">0</span>
  </div>

  <button class="button" onclick="location.href='deposite.html'">ğŸ’° Deposit</button>
  <button class="button" onclick="location.href='withdral.html'">ğŸ¦ Withdraw</button>
  <button class="button secondary" onclick="location.href='transaction.html'">ğŸ“œ Transaction History</button>

  <div id="adminSection">
    <h3>Admin Actions</h3>
    <button class="button" onclick="location.href='admin.html'">ğŸ‘® Admin Panel</button>
  </div>

</div>

<footer>
  <div class="nav-btn" onclick="location.href='gamezone.html'">ğŸ®<br>Game</div>
  <div class="nav-btn" onclick="location.href='history.html'">ğŸ“œ<br>History</div>
  <div class="nav-btn" onclick="location.href='leaderboard.html'">ğŸ†<br>Leaderboard</div>
  <div class="nav-btn active">ğŸ‘¤<br>Profile</div>
  <div class="nav-btn" onclick="location.href='more.html'">â‹¯<br>More</div>
</footer>

<script>
/* ================= AUTH ================= */
const token = localStorage.getItem("token");
if (!token) {
  alert("Please login first");
  location.href = "login.html";
}


/* â¬… BACK LOGIC (ANDROID STYLE) */
function goBack() {
  if (document.referrer && document.referrer !== location.href) {
    history.back();
  } else {
    location.href = "gamezone.html"; // fallback
  }
}

/* ğŸ‘† SWIPE BACK */
let startX = 0;
document.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
});
document.addEventListener("touchend", e => {
  const endX = e.changedTouches[0].clientX;
  if (startX < 40 && endX - startX > 90) {
    goBack();
  }
});



const avatarImg = document.getElementById("avatar-img");
const avatarInput = document.getElementById("avatarInput");

/* ================= LOAD PROFILE ================= */
async function loadProfile() {
  try {
    const res = await fetch("https://battlepurse-28.onrender.com/api/wallet/profile", {
      headers: { Authorization: "Bearer " + token }
    });
    const data = await res.json();

    const u = data.user;
    username.innerText = u.name;
    mobile.innerText = u.phone;
    email.innerText = u.email || "Not set";
    userid.innerText = u.id;

    if (u.avatarUrl) avatarImg.src = u.avatarUrl;

    const ids = u.uids || {};
    ffid.value = ids.freeFire || "";
    bgmiid.value = ids.bgmi || "";
    carrom.value = ids.carrom || "";
    ludo.value = ids.ludo || "";

    if (u.isAdmin) {
      adminSection.style.display = "block";
    }

    const wbRes = await fetch("https://battlepurse-28.onrender.com/api/wallet/balance", {
      headers: { Authorization: "Bearer " + token }
    });
    const wb = await wbRes.json();
    wallet.innerText = wb.balance || 0;

  } catch (err) {
    console.error("Profile load error:", err);
    alert("Failed to load profile");
  }
}

/* ================= AVATAR UPLOAD ================= */
async function uploadAvatar() {
  const file = avatarInput.files[0];
  if (!file) return;

  if (!file.type.startsWith("image/")) {
    alert("Please select an image");
    return;
  }

  if (file.size > 2 * 1024 * 1024) {
    alert("Image must be less than 2MB");
    return;
  }

  avatarImg.src = URL.createObjectURL(file);

  const fd = new FormData();
  fd.append("avatar", file);

  try {
    const res = await fetch("https://battlepurse-28.onrender.com/api/wallet/upload-avatar", {
      method: "POST",
      headers: { Authorization: "Bearer " + token },
      body: fd
    });
    const d = await res.json();

    if (!res.ok || !d.success) {
      throw new Error(d.msg || "Upload failed");
    }

    avatarImg.src = d.url;
    alert("Avatar updated successfully");

  } catch (err) {
    console.error("Avatar upload error:", err);
    alert("Avatar upload failed");
  }
}

window.onload = loadProfile;
</script>

</body>
</html> 