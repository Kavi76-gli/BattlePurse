<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join Match</title>

<style>
/* =====================
   GLOBAL NEON THEME
===================== */
:root {
  --neon: #00cfff;
  --neon-soft: rgba(0, 207, 255, 0.3);
  --bg-dark: #050b14;
  --card: #0b1625;
  --border: #12314d;
  --text: #e8f7ff;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", system-ui, sans-serif;
  background: radial-gradient(circle at top, #08172a, #02040a);
  color: var(--text);
}

/* =====================
   TOP BAR
===================== */
.top-bar {
  display: flex;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(180deg, #08172a, #050b14);
}

.back-btn {
  font-size: 22px;
  cursor: pointer;
  color: var(--neon);
  text-shadow: 0 0 10px var(--neon);
}

.top-title {
  flex: 1;
  text-align: center;
  font-weight: 700;
  letter-spacing: 1px;
}

/* =====================
   CONTAINER
===================== */
.container {
  max-width: 820px;
  margin: auto;
  padding: 16px;
}

/* =====================
   CARDS & BUTTONS
===================== */
.card {
  background: linear-gradient(180deg, #0c1a2e, #071221);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 0 25px var(--neon-soft);
}

.neon-btn {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  border: 1px solid var(--neon);
  background: transparent;
  color: var(--neon);
  font-weight: 600;
  cursor: pointer;
  text-shadow: 0 0 10px var(--neon);
  transition: 0.25s;
}

.neon-btn:hover {
  background: var(--neon);
  color: #000;
  box-shadow: 0 0 20px var(--neon);
}

/* =====================
   FORM
===================== */
label {
  display: block;
  margin-top: 12px;
  font-size: 13px;
  color: #a9dfff;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: #030914;
  color: var(--text);
}

.inline {
  display: flex;
  gap: 8px;
}

/* =====================
   MODE TILES
===================== */
.tile {
  padding: 14px;
  text-align: center;
  border-radius: 12px;
  border: 1px solid var(--border);
  margin-bottom: 10px;
  cursor: pointer;
  transition: 0.2s;
}

.tile:hover {
  border-color: var(--neon);
  box-shadow: 0 0 15px var(--neon-soft);
}

/* =====================
   GUN SELECT
===================== */
.guns {
  display: none;
  margin-top: 10px;
  padding: 10px;
  border: 1px dashed var(--neon);
  border-radius: 10px;
}

.guns label {
  display: inline-block;
  margin-right: 10px;
  font-size: 12px;
}

/* =====================
   MESSAGE
===================== */
.message {
  margin-top: 12px;
  text-align: center;
  font-weight: bold;
}

/* =====================
   MOBILE
===================== */
@media (max-width: 600px) {
  .container { padding: 12px; }
}


/* =========================
   MATCH TYPE CARDS (PRO)
========================= */

.match-type-section {
  margin-top: 20px;
}

.section-title {
  text-align: center;
  margin-bottom: 18px;
  font-size: 20px;
  letter-spacing: 1px;
  text-shadow: 0 0 10px var(--neon-soft);
}

.match-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 16px;
}

.match-card {
  background: linear-gradient(180deg, #0d1c33, #071221);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 22px 12px;
  text-align: center;
  cursor: pointer;
  position: relative;
  transition: all 0.25s ease;
  box-shadow: 0 0 25px rgba(0, 207, 255, 0.15);
}

.match-card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 16px;
  background: linear-gradient(120deg, transparent, rgba(0,207,255,0.25), transparent);
  opacity: 0;
  transition: 0.3s;
}

.match-card:hover::before {
  opacity: 1;
}

.match-card:hover {
  transform: translateY(-6px) scale(1.03);
  border-color: var(--neon);
  box-shadow: 0 0 35px rgba(0, 207, 255, 0.6);
}

.match-icon {
  font-size: 32px;
  margin-bottom: 10px;
  text-shadow: 0 0 15px var(--neon);
}

.match-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--neon);
  letter-spacing: 1px;
}

.match-desc {
  margin-top: 6px;
  font-size: 13px;
  color: #a9dfff;
}


.panel {
  background: linear-gradient(180deg, #0b1e36, #071221);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 0 30px rgba(0, 207, 255, 0.2);
  margin-top: 20px;
}

.panel h2 {
  text-align: center;
  color: var(--neon);
  margin-bottom: 15px;
  text-shadow: 0 0 12px var(--neon-soft);
}

.panel label {
  display: block;
  margin-top: 12px;
  font-size: 14px;
  color: #9fdcff;
}

.panel select,
.panel input {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 10px;
  background: #050e1d;
  border: 1px solid #12314d;
  color: #e8f7ff;
}

.inline {
  display: flex;
  gap: 10px;
}

.controls {
  margin-top: 18px;
  display: flex;
  gap: 12px;
}

.message {
  margin-top: 12px;
  text-align: center;
  font-size: 14px;
}

/* =========================
   BUTTON SYSTEM (PRO)
========================= */

.btn {
  padding: 12px 18px;
  border-radius: 12px;
  font-weight: 700;
  letter-spacing: 0.6px;
  cursor: pointer;
  transition: all 0.25s ease;
  border: none;
  outline: none;
  text-align: center;
  font-size: 14px;
}

/* üîµ PRIMARY ‚Äì JOIN */
.btn-primary {
  background: linear-gradient(135deg, #00cfff, #007bff);
  color: #000;
  box-shadow: 0 0 18px rgba(0, 207, 255, 0.7);
}

.btn-primary:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 0 30px rgba(0, 207, 255, 1);
}

/* ‚ö™ GHOST ‚Äì CANCEL / BACK */
.btn-ghost {
  background: transparent;
  border: 1px solid var(--neon);
  color: var(--neon);
  text-shadow: 0 0 10px var(--neon);
}

.btn-ghost:hover {
  background: var(--neon);
  color: #000;
  box-shadow: 0 0 25px var(--neon);
}

/* üîô BACK BUTTON (TOP BAR) */
.back-btn {
  padding: 8px 14px;
  border-radius: 10px;
  border: 1px solid var(--neon);
  color: var(--neon);
  cursor: pointer;
  font-weight: 700;
  letter-spacing: 1px;
  transition: all 0.25s ease;
  text-shadow: 0 0 10px var(--neon);
}

.back-btn:hover {
  background: var(--neon);
  color: #000;
  box-shadow: 0 0 20px var(--neon);
  transform: translateX(-2px);
}

/* =========================
   BUTTON GROUP
========================= */
.controls {
  display: flex;
  gap: 12px;
  margin-top: 16px;
}

.controls .btn {
  flex: 1;
}


</style> 
</head>
<body>



<div id="backBtn" class="back-btn">‚¨Ö Back</div>


<h1>Join BGMI / Free Fire Match</h1>

<!-- Match Type Selection -->
<!-- Match Type Selection -->
<div id="modeSection" class="match-type-section">
  <h2 class="section-title">Select Match Type</h2>

  <div class="match-cards">

    <div class="match-card" onclick="openMatchForm('1v1')">
      <div class="match-icon">‚öîÔ∏è</div>
      <div class="match-title">1v1</div>
      <div class="match-desc">Solo vs Solo</div>
    </div>

    <div class="match-card" onclick="openMatchForm('2v2')">
      <div class="match-icon">üî•</div>
      <div class="match-title">2v2</div>
      <div class="match-desc">Duo Battle</div>
    </div>

    <div class="match-card" onclick="openMatchForm('3v3')">
      <div class="match-icon">üí•</div>
      <div class="match-title">3v3</div>
      <div class="match-desc">Triple Team War</div>
    </div>

    <div class="match-card" onclick="openMatchForm('4v4')">
      <div class="match-icon">üöÄ</div>
      <div class="match-title">4v4</div>
      <div class="match-desc">Squad Fight</div>
    </div>

  </div>
</div>


<!-- Prize System for team matches -->
<div id="prizeSystemSection" class="match-type-section">
  <h3 class="section-title">Select Winning System</h3>

  <div class="match-cards">

    <div class="match-card" onclick="selectPrizeSystem('kill_based')">
      <div class="match-icon">üéØ</div>
      <div class="match-title">Kill Based</div>
      <div class="match-desc">Prize depends on kills</div>
    </div>

    <div class="match-card" onclick="selectPrizeSystem('team_equal')">
      <div class="match-icon">ü§ù</div>
      <div class="match-title">Team Equal</div>
      <div class="match-desc">Prize split equally</div>
    </div>

  </div>

  <button type="button" class="btn btn-ghost" onclick="backToModes()">‚¨Ö Back</button>
</div>


<!-- Join Match Form -->
<div class="panel" style="display:none;">
  <h2 id="join-title">Join Match</h2>
  <form id="matchForm" onsubmit="return false;">

    <!-- Hidden inputs -->
    <input type="hidden" id="type" value="">
    <input type="hidden" id="prizeSystem" value="">

    <!-- Game -->
<!-- Game -->
    <label for="game">Game</label>
    <select id="game" onchange="updateGameOptions()">
      <option value="">Select Game</option>
      <option value="Free Fire">Free Fire</option>
      <option value="BGMI">BGMI</option>
    </select>

    <!-- ‚úÖ BGMI COMING SOON -->
    <div id="bgmiComingSoon" class="match-type-section" style="display:none; margin-top:20px;">
      <div class="match-card">
        <div class="match-icon">üöß</div>
        <div class="match-title">BGMI</div>
        <div class="match-desc">Coming Soon</div>
      </div>
    </div>




    <!-- üëá ADD THIS WRAPPER -->
<div id="joinFields">




    <!-- Mode -->
    <label for="mode">Mode</label>
    <select id="mode" onchange="updateMapOptions()"></select>

    <!-- Map -->
    <div id="mapSection" style="display:none">
      <label for="map">Map</label>
      <select id="map"></select>
    </div>

    <!-- Rounds -->
    <label for="rounds">Rounds</label>
    <select id="rounds">
      <option value="">Select Rounds</option>
      <option value="7">7</option>
      <option value="9">9</option>
      <option value="11">11</option>
      <option value="13">13</option>
      <option value="15">15</option>
    </select>

    <!-- Free Fire advanced settings -->
    <div id="freeFireFields" style="display:none;">
      <label for="headshot">Headshot</label>
      <select id="headshot">
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>

      <label for="characterSkill">Character Skill</label>
      <select id="characterSkill">
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>

      <label for="gunAttributes">Gun Attributes</label>
      <select id="gunAttributes">
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>

      <label for="throwableLimit">Throwable Limit</label>
      <select id="throwableLimit">
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>
      

      <label for="roomType">Room Type</label>
      <select id="roomType" onchange="toggleGunSelection()">
        <option value="Regular">Regular</option>
        <option value="Advance">Advance</option>
      </select>

      <div id="gunSelection" class="guns" aria-label="Gun Selection (Advance)">
        <div id="gunsList" class="gun-row"></div>
      </div>
    </div>

    <!-- UID -->
    <label for="uid">Game UID</label>
    <input type="text" id="uid" placeholder="Enter your game UID">

    <!-- WhatsApp -->
    <label>WhatsApp Number</label>
    <div class="inline">
      <select id="countryCode">
        <option value="+91">+91 (India)</option>
        <option value="+1">+1 (USA)</option>
        <option value="+44">+44 (UK)</option>
        <option value="+61">+61 (AUS)</option>
      </select>
      <input type="text" id="whatsappNumber" placeholder="e.g. 9876543210">
    </div>

    <!-- Entry Fee -->
    <label>Entry Fee</label>
    <div class="inline">
      <select id="fee" onchange="toggleCustomFee()">
        <option value="50">‚Çπ50</option>
        <option value="100">‚Çπ100</option>
        <option value="150">‚Çπ150</option>
        <option value="200">‚Çπ200</option>
        <option value="custom">Custom</option>
      </select>
      <input type="number" id="customFee" min="50" placeholder="Custom (min ‚Çπ50)" style="display:none;">
    </div>

    <div class="controls">
      <button type="button" class="btn btn-primary" onclick="joinMatch()">Join Match</button>
      <button type="button" class="btn btn-ghost" onclick="showHome()">Cancel</button>
    </div>

    <div id="form-message" class="message" role="status" aria-live="polite"></div>

  </form>

  

</div>

<body>
  
</body>
<script>
// =========================
// VARIABLES & CONSTANTS
// =========================
let selectedType = '';
let selectedPrizeSystem = null;
const API_BASE = 'https://battlepurse-88.onrender.com'; // change to your backend URL
const TOKEN = localStorage.getItem('token') || '';


 /* ------------- Preserve existing functions ------------- */
/* =========================
   ENTRY FEE HANDLER (GLOBAL)
========================= */
function toggleCustomFee() {
  const feeSelect = document.getElementById("fee");
  const customFeeInput = document.getElementById("customFee");

  if (!feeSelect || !customFeeInput) {
    console.warn("Fee or customFee element missing");
    return;
  }

  if (feeSelect.value === "custom") {
    customFeeInput.style.display = "block";
    customFeeInput.focus();
  } else {
    customFeeInput.style.display = "none";
    customFeeInput.value = "";
  }
}





const BGMI_MODES = ["TDM","Gun Game"];
const FF_MODES = ["Clash Squad","Lone Wolf"];
const CLASH_SQUAD_MAPS = ["Bermuda","Alpine","Kalahari","Purgatory","Nexterra"];
const LONE_WOLF_MAPS = ["Iron Cage"];
const ALLOWED_ROUNDS = [7,9,11,13,15];

const GUN_CATEGORIES = {
  AR: ["AK","M4A1","SCAR","GROZA","FAMAS","AN94","XM8","M14","PARAFAL","KINGFISHER","AUG","AC80"],
  SMG: ["MP40","MP5","UMP","VSS","THOMPSON","VECTOR","BIZON","UZI","MAC10"],
  SNIPER: ["AWM","KAR98K","M82B","M24","SVD","SKS","WOODPECKER"],
  SHOTGUN: ["M1014","M1887","MAG7","SPAS12","Trogon"],
  PISTOLS: ["USP","G18","M500","Desert Eagle","Treatment Pistol","Hand Cannon"],
  LAUNCHERS: ["M79","RGS50","MGL140"],
  SPECIAL: ["Plasma Gun","Laser Gun (CS)","CG15","Crossbow","Flame Bow"]
};


// DOM elements
const modeSection = document.getElementById('modeSection');
const prizeSystemSection = document.getElementById('prizeSystemSection');
const panel = document.querySelector('.panel');
const formMessage = document.getElementById('form-message');

const gameEl = document.getElementById('game');
const modeEl = document.getElementById('mode');
const mapSection = document.getElementById('mapSection');
const mapEl = document.getElementById('map');

const freeFireFields = document.getElementById('freeFireFields');
const roomTypeEl = document.getElementById('roomType');
const gunSelection = document.getElementById('gunSelection');
const gunsList = document.getElementById('gunsList');

const uidEl = document.getElementById('uid');
const countryCodeEl = document.getElementById('countryCode');
const whatsappEl = document.getElementById('whatsappNumber');

const feeEl = document.getElementById('fee');
const customFeeEl = document.getElementById('customFee');
const joinBtn = document.querySelector('#matchForm button.btn-primary');

// =========================
// HELPER FUNCTIONS
// =========================
function show(el){ if(el) el.style.display='block'; }
function hide(el){ if(el) el.style.display='none'; }
function setMessage(txt,danger=true){ formMessage.textContent=txt||''; if(!txt) return; formMessage.style.color=danger?'red':'green'; }
function getFinalEntryFee(){
  const selected = feeEl.value;
  if(!selected){ setMessage("Select entry fee"); return null; }
  if(selected==='custom'){ const val=Number(customFeeEl.value); if(!val || val<50){ setMessage("Custom fee must be ‚â•50"); return null; } return val; }
  return Number(selected);
}

// =========================
// GAME / MODE / MAP
// =========================
function updateGameOptions() {
  // reset dropdowns safely
  modeEl.innerHTML = '';
  mapEl.innerHTML = '';

  const g = gameEl.value;

  // üëá required elements
  const bgmiSoon = document.getElementById("bgmiComingSoon");
  const joinFields = document.getElementById("joinFields");

  if (!bgmiSoon || !joinFields) {
    console.warn("bgmiComingSoon or joinFields missing");
    return;
  }

  // üöß BGMI ‚Üí Coming Soon only
  if (g === 'BGMI') {
    bgmiSoon.style.display = 'block';
    joinFields.style.display = 'none';

    hide(freeFireFields);
    hide(mapSection);
    return;
  }

  // üî• Free Fire ‚Üí full playable form
  if (g === 'Free Fire') {
    bgmiSoon.style.display = 'none';
    joinFields.style.display = 'block';

    FF_MODES.forEach(m => modeEl.appendChild(new Option(m, m)));

    show(freeFireFields);
    show(mapSection);

    updateMapOptions();
    toggleGunSelection();
    return;
  }

  // üßº No game selected
  bgmiSoon.style.display = 'none';
  joinFields.style.display = 'none';
  hide(freeFireFields);
  hide(mapSection);
}





function updateMapOptions(){
  mapEl.innerHTML=''; const g=gameEl.value; const m=modeEl.value;
  if(g!=='Free Fire'){ hide(mapSection); return;} show(mapSection);
  const maps = m==='Clash Squad'?CLASH_SQUAD_MAPS:LONE_WOLF_MAPS;
  maps.forEach(mp=>mapEl.appendChild(new Option(mp,mp)));
}

function toggleGunSelection(){
  if(roomTypeEl.value==='Advance'){ show(gunSelection); gunsList.innerHTML='';
    for(const cat in GUN_CATEGORIES){ const label=document.createElement('div'); label.textContent=cat; label.style.fontSize='12px'; label.style.color='#999'; gunsList.appendChild(label);
      GUN_CATEGORIES[cat].forEach(gun=>{ const l=document.createElement('label'); l.innerHTML=`<input type="checkbox" value="${gun}" style="margin-right:6px">${gun}`; gunsList.appendChild(l);});
    }
  } else { hide(gunSelection); gunsList.innerHTML=''; }
}

// =========================
// MATCH FORM LOGIC
// =========================
function openMatchForm(type){ selectedType=type; document.getElementById('type').value=type;
  if(type==='1v1'){ selectedPrizeSystem='kill_based'; document.getElementById('prizeSystem').value=selectedPrizeSystem; hide(prizeSystemSection); showForm(); }
  else{ show(prizeSystemSection); hide(modeSection);}
}
function selectPrizeSystem(ps){ selectedPrizeSystem=ps; document.getElementById('prizeSystem').value=ps; hide(prizeSystemSection); showForm();}
function backToModes(){ hide(prizeSystemSection); show(modeSection);}
function showHome(){ selectedType=''; selectedPrizeSystem=null; hide(panel); show(modeSection); setMessage('');}
function showForm(){ updateGameOptions(); setMessage(''); document.getElementById('join-title').textContent=selectedType?`Join ${selectedType} Match`:'Join Match'; show(panel); window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});}

// =========================
// ENTRY FEE LOGIC
// =========================
feeEl.addEventListener('change',()=>{ if(feeEl.value==='custom'){ show(customFeeEl); customFeeEl.value=''; customFeeEl.focus(); joinBtn.disabled=true; joinBtn.style.opacity='0.5'; } else { hide(customFeeEl); customFeeEl.value=''; joinBtn.disabled=false; joinBtn.style.opacity='1'; }});
customFeeEl.addEventListener('input',()=>{ const val=Number(customFeeEl.value); if(!val || val<50){ setMessage('Minimum custom fee ‚Çπ50'); joinBtn.disabled=true; joinBtn.style.opacity='0.5';} else { setMessage(''); joinBtn.disabled=false; joinBtn.style.opacity='1';}});

// =========================
// JOIN MATCH
// =========================
async function joinMatch(){
  setMessage(''); if(!selectedType){ setMessage('Select match type'); return;}
  if(selectedType!=='1v1' && !selectedPrizeSystem){ setMessage('Select prize system'); return;}

  const game=gameEl.value; const mode=modeEl.value;
  let map=mapEl.value||undefined; const roomType=roomTypeEl.value;
  const uid=uidEl.value.trim(); const countryCode=countryCodeEl.value.trim();
  const whatsappRaw=whatsappEl.value.replace(/\s+/g,'').trim();
  const rounds=Number(document.getElementById('rounds').value);

  if(!uid){ setMessage('Enter Game UID'); return;}
  if(!countryCode.startsWith('+')){ setMessage('Invalid country code'); return;}
  if(!/^\d{10,15}$/.test(whatsappRaw)){ setMessage('Invalid WhatsApp number'); return;}
  if(!ALLOWED_ROUNDS.includes(rounds)){ setMessage('Invalid rounds'); return;}

  if(game==='Free Fire' && mode==='Lone Wolf') map='Iron Cage';
  const headshot=document.getElementById('headshot')?.value==='true';
  const characterSkill=document.getElementById('characterSkill')?.value==='true';
  const gunAttributes=document.getElementById('gunAttributes')?.value==='true';
  const throwableLimit=document.getElementById('throwableLimit')?.value==='true';

  const feeVal=getFinalEntryFee(); if(feeVal===null) return;

  const selectedGuns=[]; if(game==='Free Fire' && roomType==='Advance'){
    document.querySelectorAll('#gunsList input[type=checkbox]:checked').forEach(cb=>selectedGuns.push(cb.value));
  }

  const payload={ type:selectedType, game, mode, rounds, fee:feeVal, uid, prizeSystem:selectedPrizeSystem,
    countryCode, whatsappNumber:whatsappRaw, map, roomType, headshot, characterSkill, gunAttributes, throwableLimit,
    selectedGuns };

  try{
    setMessage('‚è≥ Joining match...', false);
    const res=await fetch(`${API_BASE}/api/wallet/joins`,{ method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+TOKEN}, body:JSON.stringify(payload)});
    const data=await res.json();
    if(!res.ok || !data.success) throw new Error(data.msg||'Failed to join');
    setMessage(`üéâ Joined successfully ‚Äî ‚Çπ${feeVal} deducted`, false);
    setTimeout(()=>{ const matchId=data.match?._id||data.matchId; if(matchId) window.location.href=`user-room.html?id=${matchId}`;},1000);
  } catch(err){ console.error(err); setMessage('‚ùå '+(err.message||'Join failed'));}
}

// =========================
// INIT
// =========================
(function init(){ hide(prizeSystemSection); hide(panel); })();

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("backBtn")?.addEventListener("click", () => {
    window.location.href = "gamezone.html";
  });
});



</script>

</body>
</html>
