<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Join Tournament</title>
  <style>
    body {
      background: #0a0a0a;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      padding: 30px;
    }
    h2 { color: #00faff; }
    .inputBox { margin: 10px 0; }
    input {
      width: 80%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      outline: none;
      text-align: center;
      font-size: 16px;
      background: #1c1c1c;
      color: #fff;
    }
    button {
      background: #00c853;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      transition: 0.2s;
    }
    button:hover { background: #009624; }
    .info { margin: 10px 0; color: #bbb; }


    /* ================ SWIPE BACK ================= */
/* SWIPE BACK EDGE */
.swipe-area {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  width: 24px;
  z-index: 50;
}

/* MOBILE TWEAKS */
@media (max-width: 480px) {
  h1 { font-size: 1.5rem; }
  .app-header img { height: 34px; }
}
  </style>
</head>
<body>
  <!-- Swipe-back edge -->
<div class="swipe-area"></div>

<!-- APP BAR -->
<div class="app-bar">
  <button onclick="goBack()">‚Üê</button>
  <div class="app-title">Tournament</div>
</div>

  <h2 id="tName">Loading tournament...</h2>
  <p id="tMode"></p>
  <div id="uidContainer"></div>
  <button onclick="submitJoin()">Join Tournament</button>

  <script>
    const token = localStorage.getItem('token');
    const params = new URLSearchParams(window.location.search);
    const tournamentId = params.get('id');

    const TOURNAMENT_URL = `https://battlepurse-98-8d98.onrender.com/api/wallet/tournaments/${tournamentId}`;
    const JOIN_URL = `https://battlepurse-98-8d98.onrender.com/api/wallet/join/${tournamentId}`;

    let mode = 'solo';
    let requiredUids = 1;

    // Load tournament details
    async function loadTournament() {
      try {
        const res = await fetch(TOURNAMENT_URL, {
          headers: { Authorization: `Bearer ${token}` }
        });
        const t = await res.json();

        if (!res.ok) {
          alert(t.msg || 'Failed to load tournament');
          return;
        }

        document.getElementById('tName').innerText = t.name;
        document.getElementById('tMode').innerText = `Mode: ${t.mode}`;
        mode = t.mode;

        // Determine number of required UIDs
        if (mode === 'duo') requiredUids = 2;
        else if (mode === 'squad') requiredUids = 4;
        else requiredUids = 1;

        const container = document.getElementById('uidContainer');
        container.innerHTML = '';

        for (let i = 1; i <= requiredUids; i++) {
          const div = document.createElement('div');
          div.className = 'inputBox';
          div.innerHTML = `<input type="text" id="uid${i}" placeholder="Enter Player ${i} UID" required />`;
          container.appendChild(div);
        }

      } catch (err) {
        console.error(err);
        alert('Error loading tournament details');
      }
    }

    // Submit join request
    async function submitJoin() {
      const uids = [];
      document.querySelectorAll('input[id^="uid"]').forEach(inp => {
        if (inp.value.trim() !== '') uids.push(inp.value.trim());
      });

      if (uids.length !== requiredUids) {
        alert(`Please enter exactly ${requiredUids} UID(s) for ${mode} mode`);
        return;
      }

      try {
        const res = await fetch(JOIN_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ uids })
        });

        const data = await res.json();

        if (res.ok) {
          alert(data.msg || 'Successfully joined!');
          window.location.href = `./joined.html?id=${tournamentId}`;
        } else {
          alert(data.msg || 'Join failed');
        }
      } catch (err) {
        console.error(err);
        alert('Error joining tournament');
      }
    }

    loadTournament();

    /* ‚¨Ö BACK LOGIC (ANDROID STYLE) */
function goBack(){
  if(document.referrer && document.referrer !== location.href){
    history.back();
  }else{
    location.href="gamezone.html"; // fallback
  }
}

/* üëÜ SWIPE BACK */
let startX=0, startY=0;
const arrow=document.querySelector('.swipe-arrow');

document.addEventListener("touchstart", e=>{
  const t=e.touches[0];
  if(t.clientX < 30){
    startX=t.clientX;
    startY=t.clientY;
    arrow.style.opacity="1";
  }
});

document.addEventListener("touchmove", e=>{
  if(!startX) return;
  const dx=e.touches[0].clientX - startX;
  if(dx>0){
    arrow.style.left=Math.min(dx-18,50)+"px";
  }
});

document.addEventListener("touchend", e=>{
  if(!startX) return;

  const dx=e.changedTouches[0].clientX - startX;
  const dy=Math.abs(e.changedTouches[0].clientY - startY);

  arrow.style.left="-44px";
  arrow.style.opacity="0";

  if(startX < 30 && dx > 90 && dy < 70){
    goBack();
  }
  startX=0;
});

  </script>
</body>
</html>
